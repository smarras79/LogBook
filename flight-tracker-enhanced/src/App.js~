import React, { useState, useEffect } from 'react';
import { Plane, Plus, Trash2, Edit2, X, Calendar, LogOut, User, Mail, Lock, Eye, EyeOff } from 'lucide-react';

// Airport database
const AIRPORTS_DATABASE = [
  { code: 'JFK', name: 'John F. Kennedy International Airport', city: 'New York', country: 'United States', lat: 40.6413, lon: -73.7781 },
  { code: 'LAX', name: 'Los Angeles International Airport', city: 'Los Angeles', country: 'United States', lat: 33.9416, lon: -118.4085 },
  { code: 'ORD', name: "O'Hare International Airport", city: 'Chicago', country: 'United States', lat: 41.9742, lon: -87.9073 },
  { code: 'ATL', name: 'Hartsfield-Jackson Atlanta International Airport', city: 'Atlanta', country: 'United States', lat: 33.6407, lon: -84.4277 },
  { code: 'DFW', name: 'Dallas/Fort Worth International Airport', city: 'Dallas', country: 'United States', lat: 32.8998, lon: -97.0403 },
  { code: 'DEN', name: 'Denver International Airport', city: 'Denver', country: 'United States', lat: 39.8561, lon: -104.6737 },
  { code: 'SFO', name: 'San Francisco International Airport', city: 'San Francisco', country: 'United States', lat: 37.6213, lon: -122.3790 },
  { code: 'SEA', name: 'Seattle-Tacoma International Airport', city: 'Seattle', country: 'United States', lat: 47.4502, lon: -122.3088 },
  { code: 'MIA', name: 'Miami International Airport', city: 'Miami', country: 'United States', lat: 25.7959, lon: -80.2870 },
  { code: 'LHR', name: 'London Heathrow Airport', city: 'London', country: 'United Kingdom', lat: 51.4700, lon: -0.4543 },
  { code: 'CDG', name: 'Charles de Gaulle Airport', city: 'Paris', country: 'France', lat: 49.0097, lon: 2.5479 },
  { code: 'FRA', name: 'Frankfurt Airport', city: 'Frankfurt', country: 'Germany', lat: 50.0379, lon: 8.5622 },
  { code: 'AMS', name: 'Amsterdam Airport Schiphol', city: 'Amsterdam', country: 'Netherlands', lat: 52.3105, lon: 4.7683 },
  { code: 'MAD', name: 'Madrid-Barajas Airport', city: 'Madrid', country: 'Spain', lat: 40.4936, lon: -3.5668 },
  { code: 'BCN', name: 'Barcelona-El Prat Airport', city: 'Barcelona', country: 'Spain', lat: 41.2974, lon: 2.0833 },
  { code: 'FCO', name: 'Leonardo da Vinci-Fiumicino Airport', city: 'Rome', country: 'Italy', lat: 41.8003, lon: 12.2389 },
  { code: 'HND', name: 'Tokyo Haneda Airport', city: 'Tokyo', country: 'Japan', lat: 35.5494, lon: 139.7798 },
  { code: 'NRT', name: 'Narita International Airport', city: 'Tokyo', country: 'Japan', lat: 35.7720, lon: 140.3929 },
  { code: 'SIN', name: 'Singapore Changi Airport', city: 'Singapore', country: 'Singapore', lat: 1.3644, lon: 103.9915 },
  { code: 'ICN', name: 'Incheon International Airport', city: 'Seoul', country: 'South Korea', lat: 37.4602, lon: 126.4407 },
  { code: 'HKG', name: 'Hong Kong International Airport', city: 'Hong Kong', country: 'Hong Kong', lat: 22.3080, lon: 113.9185 },
  { code: 'DXB', name: 'Dubai International Airport', city: 'Dubai', country: 'UAE', lat: 25.2532, lon: 55.3657 },
  { code: 'SYD', name: 'Sydney Kingsford Smith Airport', city: 'Sydney', country: 'Australia', lat: -33.9399, lon: 151.1753 },
  { code: 'MEL', name: 'Melbourne Airport', city: 'Melbourne', country: 'Australia', lat: -37.6690, lon: 144.8410 },
];

const serviceClasses = ['Economy', 'Premium Economy', 'Business', 'First'];

const calculateDistance = (lat1, lon1, lat2, lon2) => {
  const R = 3958.8;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
};

const FlightTracker = () => {
  const [user, setUser] = useState(null);
  const [showAuth, setShowAuth] = useState(false);
  const [authMode, setAuthMode] = useState('login');
  const [flights, setFlights] = useState([]);
  const [showForm, setShowForm] = useState(false);
  const [editingFlight, setEditingFlight] = useState(null);
  
  // Form state - keep it super simple
  const [originCode, setOriginCode] = useState('');
  const [destCode, setDestCode] = useState('');
  const [flightDate, setFlightDate] = useState('');
  const [flightClass, setFlightClass] = useState('Economy');
  
  // Search dropdowns
  const [originSearch, setOriginSearch] = useState('');
  const [destSearch, setDestSearch] = useState('');
  const [showOriginDropdown, setShowOriginDropdown] = useState(false);
  const [showDestDropdown, setShowDestDropdown] = useState(false);
  
  const [authData, setAuthData] = useState({ email: '', password: '', confirmPassword: '', name: '' });
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const userData = localStorage.getItem('user-profile');
    if (userData) {
      setUser(JSON.parse(userData));
      setShowAuth(false);
    } else {
      setShowAuth(true);
    }
    const flightsData = localStorage.getItem('flights-data');
    if (flightsData) {
      setFlights(JSON.parse(flightsData));
    }
    setLoading(false);
  }, []);

  const saveFlights = (updatedFlights) => {
    localStorage.setItem('flights-data', JSON.stringify(updatedFlights));
  };

  const handleAuth = (e) => {
    e.preventDefault();
    if (authMode === 'register') {
      if (authData.password !== authData.confirmPassword) {
        alert('Passwords do not match');
        return;
      }
      const newUser = {
        id: Date.now(),
        email: authData.email,
        name: authData.name,
        createdAt: new Date().toISOString()
      };
      localStorage.setItem('user-profile', JSON.stringify(newUser));
      setUser(newUser);
      setShowAuth(false);
    } else {
      const userData = localStorage.getItem('user-profile');
      if (userData) {
        const existingUser = JSON.parse(userData);
        if (existingUser.email === authData.email) {
          setUser(existingUser);
          setShowAuth(false);
        } else {
          alert('User not found. Please register.');
        }
      } else {
        alert('No account found. Please register.');
      }
    }
    setAuthData({ email: '', password: '', confirmPassword: '', name: '' });
  };

  const handleLogout = () => {
    setUser(null);
    setShowAuth(true);
  };

  // Filter airports based on search
  const getFilteredAirports = (searchTerm) => {
    if (!searchTerm || searchTerm.length < 2) return [];
    const term = searchTerm.toLowerCase();
    return AIRPORTS_DATABASE.filter(airport =>
      airport.code.toLowerCase().includes(term) ||
      airport.city.toLowerCase().includes(term) ||
      airport.name.toLowerCase().includes(term) ||
      airport.country.toLowerCase().includes(term)
    ).slice(0, 10);
  };

  const selectOrigin = (airport) => {
    setOriginCode(airport.code);
    setOriginSearch(airport.code);
    setShowOriginDropdown(false);
  };

  const selectDestination = (airport) => {
    setDestCode(airport.code);
    setDestSearch(airport.code);
    setShowDestDropdown(false);
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    
    const originAirport = AIRPORTS_DATABASE.find(a => a.code === originCode);
    const destAirport = AIRPORTS_DATABASE.find(a => a.code === destCode);
    
    if (!originAirport || !destAirport) {
      alert('Please select valid airports from the dropdown');
      return;
    }

    const distanceMiles = Math.round(calculateDistance(
      originAirport.lat, originAirport.lon,
      destAirport.lat, destAirport.lon
    ));

    const newFlight = {
      id: editingFlight ? editingFlight.id : Date.now(),
      origin: originCode,
      destination: destCode,
      date: flightDate,
      serviceClass: flightClass,
      distanceMiles: distanceMiles,
      distanceKm: Math.round(distanceMiles * 1.60934),
      originAirport: originAirport,
      destAirport: destAirport,
      timestamp: editingFlight ? editingFlight.timestamp : Date.now(),
    };

    const updatedFlights = editingFlight
      ? flights.map(f => f.id === editingFlight.id ? newFlight : f)
      : [...flights, newFlight];
    
    setFlights(updatedFlights);
    saveFlights(updatedFlights);
    
    // Reset form
    setShowForm(false);
    setEditingFlight(null);
    setOriginCode('');
    setDestCode('');
    setOriginSearch('');
    setDestSearch('');
    setFlightDate('');
    setFlightClass('Economy');
  };

  const handleDelete = (id) => {
    const updatedFlights = flights.filter(f => f.id !== id);
    setFlights(updatedFlights);
    saveFlights(updatedFlights);
  };

  const handleEdit = (flight) => {
    setEditingFlight(flight);
    setOriginCode(flight.origin);
    setDestCode(flight.destination);
    setOriginSearch(flight.origin);
    setDestSearch(flight.destination);
    setFlightDate(flight.date);
    setFlightClass(flight.serviceClass);
    setShowForm(true);
  };

  const openAddForm = () => {
    setEditingFlight(null);
    setOriginCode('');
    setDestCode('');
    setOriginSearch('');
    setDestSearch('');
    setFlightDate('');
    setFlightClass('Economy');
    setShowForm(true);
  };

  const totalMiles = flights.reduce((sum, flight) => sum + flight.distanceMiles, 0);
  const totalKm = flights.reduce((sum, flight) => sum + flight.distanceKm, 0);

  if (loading) {
    return (
      <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
        <div style={{ width: '40px', height: '40px', border: '2px solid #f0f0f0', borderTopColor: '#0a0a0a', borderRadius: '50%', animation: 'spin 0.8s linear infinite' }}></div>
      </div>
    );
  }

  const originResults = getFilteredAirports(originSearch);
  const destResults = getFilteredAirports(destSearch);

  return (
    <div style={{ fontFamily: 'Inter, -apple-system, sans-serif', minHeight: '100vh', background: '#ffffff' }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        @keyframes spin { to { transform: rotate(360deg); } }
        body { margin: 0; padding: 0; }
      `}</style>

      {showAuth && (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '24px', zIndex: 1000 }}>
          <div style={{ background: '#fff', borderRadius: '16px', maxWidth: '480px', width: '100%', padding: '32px' }}>
            <h2 style={{ fontSize: '24px', fontWeight: '600', marginBottom: '24px' }}>
              {authMode === 'login' ? 'Welcome back' : 'Create account'}
            </h2>
            <form onSubmit={handleAuth} style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              {authMode === 'register' && (
                <div>
                  <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px' }}>NAME</label>
                  <input
                    type="text"
                    value={authData.name}
                    onChange={(e) => setAuthData({ ...authData, name: e.target.value })}
                    style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                    required
                  />
                </div>
              )}
              <div>
                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px' }}>EMAIL</label>
                <input
                  type="email"
                  value={authData.email}
                  onChange={(e) => setAuthData({ ...authData, email: e.target.value })}
                  style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                  required
                />
              </div>
              <div>
                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px' }}>PASSWORD</label>
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={authData.password}
                  onChange={(e) => setAuthData({ ...authData, password: e.target.value })}
                  style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                  required
                />
              </div>
              {authMode === 'register' && (
                <div>
                  <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px' }}>CONFIRM PASSWORD</label>
                  <input
                    type={showPassword ? 'text' : 'password'}
                    value={authData.confirmPassword}
                    onChange={(e) => setAuthData({ ...authData, confirmPassword: e.target.value })}
                    style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                    required
                  />
                </div>
              )}
              <button type="submit" style={{ padding: '12px', background: '#0a0a0a', color: '#fff', border: 'none', borderRadius: '8px', fontSize: '15px', fontWeight: '600', cursor: 'pointer' }}>
                {authMode === 'login' ? 'Sign in' : 'Create account'}
              </button>
              <button type="button" onClick={() => setAuthMode(authMode === 'login' ? 'register' : 'login')} style={{ background: 'none', border: 'none', color: '#666', fontSize: '14px', cursor: 'pointer', textDecoration: 'underline' }}>
                {authMode === 'login' ? "Don't have an account? Sign up" : 'Already have an account? Sign in'}
              </button>
            </form>
          </div>
        </div>
      )}

      {!showAuth && user && (
        <>
          <header style={{ borderBottom: '1px solid #e5e5e5', background: '#fff' }}>
            <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '20px 32px', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
              <div style={{ fontSize: '20px', fontWeight: '600' }}>FlightLog</div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <div style={{ padding: '8px 16px', background: '#f8f8f8', borderRadius: '8px', fontSize: '14px' }}>
                  {user.name}
                </div>
                <button onClick={handleLogout} style={{ padding: '10px', background: 'transparent', border: 'none', cursor: 'pointer' }}>
                  <LogOut size={20} />
                </button>
                <button onClick={openAddForm} style={{ padding: '10px 20px', background: '#0a0a0a', color: '#fff', border: 'none', borderRadius: '8px', fontSize: '14px', fontWeight: '500', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <Plus size={18} />
                  Add flight
                </button>
              </div>
            </div>
          </header>

          <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '48px 32px' }}>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '24px', marginBottom: '48px' }}>
              <div style={{ background: '#fff', border: '1px solid #e5e5e5', borderRadius: '12px', padding: '24px' }}>
                <div style={{ fontSize: '13px', fontWeight: '500', color: '#666', textTransform: 'uppercase', marginBottom: '12px' }}>TOTAL FLIGHTS</div>
                <div style={{ fontSize: '36px', fontWeight: '700', marginBottom: '4px' }}>{flights.length}</div>
                <div style={{ fontSize: '14px', color: '#999' }}>Journeys completed</div>
              </div>
              <div style={{ background: '#fff', border: '1px solid #e5e5e5', borderRadius: '12px', padding: '24px' }}>
                <div style={{ fontSize: '13px', fontWeight: '500', color: '#666', textTransform: 'uppercase', marginBottom: '12px' }}>DISTANCE</div>
                <div style={{ fontSize: '36px', fontWeight: '700', marginBottom: '4px' }}>{totalMiles.toLocaleString()}</div>
                <div style={{ fontSize: '14px', color: '#999' }}>{totalKm.toLocaleString()} kilometers</div>
              </div>
              <div style={{ background: '#fff', border: '1px solid #e5e5e5', borderRadius: '12px', padding: '24px' }}>
                <div style={{ fontSize: '13px', fontWeight: '500', color: '#666', textTransform: 'uppercase', marginBottom: '12px' }}>AROUND WORLD</div>
                <div style={{ fontSize: '36px', fontWeight: '700', marginBottom: '4px' }}>{(totalMiles / 24901).toFixed(2)}×</div>
                <div style={{ fontSize: '14px', color: '#999' }}>Earth circumferences</div>
              </div>
            </div>

            <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '24px' }}>Your flights</h2>

            {flights.length === 0 ? (
              <div style={{ textAlign: 'center', padding: '80px 32px', background: '#fafafa', borderRadius: '12px', border: '1px dashed #d0d0d0' }}>
                <Plane size={64} color="#d0d0d0" style={{ margin: '0 auto 24px' }} />
                <div style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px' }}>No flights yet</div>
                <div style={{ fontSize: '14px', color: '#999', marginBottom: '24px' }}>Start tracking your journeys</div>
                <button onClick={openAddForm} style={{ padding: '12px 24px', background: '#0a0a0a', color: '#fff', border: 'none', borderRadius: '8px', fontSize: '14px', fontWeight: '500', cursor: 'pointer', display: 'inline-flex', alignItems: 'center', gap: '8px' }}>
                  <Plus size={18} />
                  Add your first flight
                </button>
              </div>
            ) : (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                {flights.sort((a, b) => new Date(b.date) - new Date(a.date)).map((flight) => (
                  <div key={flight.id} style={{ background: '#fff', border: '1px solid #e5e5e5', borderRadius: '12px', padding: '24px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '24px', marginBottom: '16px' }}>
                      <div>
                        <div style={{ fontSize: '28px', fontWeight: '700' }}>{flight.origin}</div>
                        <div style={{ fontSize: '13px', color: '#666' }}>{flight.originAirport.city}</div>
                      </div>
                      <div style={{ flex: 1, height: '1px', background: '#e5e5e5', position: 'relative' }}>
                        <div style={{ position: 'absolute', right: '-4px', top: '-3px', width: 0, height: 0, borderLeft: '8px solid #666', borderTop: '4px solid transparent', borderBottom: '4px solid transparent' }}></div>
                      </div>
                      <div style={{ textAlign: 'right' }}>
                        <div style={{ fontSize: '28px', fontWeight: '700' }}>{flight.destination}</div>
                        <div style={{ fontSize: '13px', color: '#666' }}>{flight.destAirport.city}</div>
                      </div>
                    </div>
                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '12px', marginBottom: '12px' }}>
                      <span style={{ padding: '4px 12px', background: '#f8f8f8', borderRadius: '6px', fontSize: '13px', fontWeight: '500' }}>
                        {flight.distanceMiles.toLocaleString()} mi
                      </span>
                      <span style={{ padding: '4px 12px', background: '#f8f8f8', borderRadius: '6px', fontSize: '13px', fontWeight: '500' }}>
                        {flight.distanceKm.toLocaleString()} km
                      </span>
                      <span style={{ padding: '4px 12px', background: '#f8f8f8', borderRadius: '6px', fontSize: '13px', fontWeight: '500' }}>
                        {flight.serviceClass}
                      </span>
                    </div>
                    <div style={{ fontSize: '13px', color: '#999', marginBottom: '16px' }}>
                      {new Date(flight.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                    </div>
                    <div style={{ display: 'flex', gap: '8px', paddingTop: '16px', borderTop: '1px solid #f0f0f0' }}>
                      <button onClick={() => handleEdit(flight)} style={{ padding: '8px 16px', background: 'transparent', border: '1px solid #e5e5e5', borderRadius: '6px', fontSize: '13px', fontWeight: '500', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px' }}>
                        <Edit2 size={14} />
                        Edit
                      </button>
                      <button onClick={() => handleDelete(flight.id)} style={{ padding: '8px 16px', background: 'transparent', border: '1px solid #e5e5e5', borderRadius: '6px', fontSize: '13px', fontWeight: '500', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px' }}>
                        <Trash2 size={14} />
                        Delete
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </main>
        </>
      )}

      {showForm && (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '24px', zIndex: 1000 }}>
          <div style={{ background: '#fff', borderRadius: '16px', maxWidth: '480px', width: '100%', maxHeight: '90vh', overflowY: 'auto' }}>
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '24px 24px 0' }}>
              <h3 style={{ fontSize: '20px', fontWeight: '600' }}>{editingFlight ? 'Edit flight' : 'Add new flight'}</h3>
              <button onClick={() => setShowForm(false)} style={{ padding: '8px', background: 'transparent', border: 'none', cursor: 'pointer' }}>
                <X size={20} />
              </button>
            </div>
            <form onSubmit={handleSubmit} style={{ padding: '24px' }}>
              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px', textTransform: 'uppercase' }}>
                  ORIGIN {originCode && <span style={{ color: '#10b981' }}>✓ {originCode}</span>}
                </label>
                <div style={{ position: 'relative' }}>
                  <input
                    type="text"
                    value={originSearch}
                    onChange={(e) => {
                      setOriginSearch(e.target.value);
                      setShowOriginDropdown(true);
                    }}
                    onFocus={() => setShowOriginDropdown(true)}
                    placeholder="Type airport code or city..."
                    style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                  />
                  {showOriginDropdown && originResults.length > 0 && (
                    <div style={{ position: 'absolute', top: 'calc(100% + 8px)', left: 0, right: 0, background: '#fff', border: '1px solid #e5e5e5', borderRadius: '8px', maxHeight: '240px', overflowY: 'auto', zIndex: 50, boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}>
                      {originResults.map((airport) => (
                        <button
                          key={airport.code}
                          type="button"
                          onClick={() => selectOrigin(airport)}
                          style={{ width: '100%', padding: '12px 16px', border: 'none', background: 'transparent', textAlign: 'left', cursor: 'pointer', borderBottom: '1px solid #f0f0f0' }}
                          onMouseEnter={(e) => e.currentTarget.style.background = '#f8f8f8'}
                          onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                        >
                          <div style={{ fontWeight: '600', fontSize: '15px' }}>{airport.code}</div>
                          <div style={{ fontSize: '13px', color: '#666' }}>{airport.city}, {airport.country}</div>
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px', textTransform: 'uppercase' }}>
                  DESTINATION {destCode && <span style={{ color: '#10b981' }}>✓ {destCode}</span>}
                </label>
                <div style={{ position: 'relative' }}>
                  <input
                    type="text"
                    value={destSearch}
                    onChange={(e) => {
                      setDestSearch(e.target.value);
                      setShowDestDropdown(true);
                    }}
                    onFocus={() => setShowDestDropdown(true)}
                    placeholder="Type airport code or city..."
                    style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                  />
                  {showDestDropdown && destResults.length > 0 && (
                    <div style={{ position: 'absolute', top: 'calc(100% + 8px)', left: 0, right: 0, background: '#fff', border: '1px solid #e5e5e5', borderRadius: '8px', maxHeight: '240px', overflowY: 'auto', zIndex: 50, boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}>
                      {destResults.map((airport) => (
                        <button
                          key={airport.code}
                          type="button"
                          onClick={() => selectDestination(airport)}
                          style={{ width: '100%', padding: '12px 16px', border: 'none', background: 'transparent', textAlign: 'left', cursor: 'pointer', borderBottom: '1px solid #f0f0f0' }}
                          onMouseEnter={(e) => e.currentTarget.style.background = '#f8f8f8'}
                          onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                        >
                          <div style={{ fontWeight: '600', fontSize: '15px' }}>{airport.code}</div>
                          <div style={{ fontSize: '13px', color: '#666' }}>{airport.city}, {airport.country}</div>
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px', textTransform: 'uppercase' }}>DATE</label>
                <input
                  type="date"
                  value={flightDate}
                  onChange={(e) => setFlightDate(e.target.value)}
                  style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                  required
                />
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#666', marginBottom: '8px', textTransform: 'uppercase' }}>CLASS</label>
                <select
                  value={flightClass}
                  onChange={(e) => setFlightClass(e.target.value)}
                  style={{ width: '100%', padding: '12px 16px', border: '1px solid #e5e5e5', borderRadius: '8px', fontSize: '15px' }}
                >
                  {serviceClasses.map(cls => (
                    <option key={cls} value={cls}>{cls}</option>
                  ))}
                </select>
              </div>

              <button type="submit" style={{ width: '100%', padding: '12px', background: '#0a0a0a', color: '#fff', border: 'none', borderRadius: '8px', fontSize: '15px', fontWeight: '600', cursor: 'pointer' }}>
                {editingFlight ? 'Update flight' : 'Add flight'}
              </button>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

export default FlightTracker;
